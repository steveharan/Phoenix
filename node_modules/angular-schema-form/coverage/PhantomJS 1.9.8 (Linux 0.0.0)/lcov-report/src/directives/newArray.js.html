<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/directives/newArray.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header low">
    <h1>Code coverage report for <span class="entity">src/directives/newArray.js</span></h1>
    <h2>
        Statements: <span class="metric">0.97% <small>(1 / 103)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">0% <small>(0 / 86)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">0% <small>(0 / 19)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">0.97% <small>(1 / 103)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">src/directives/</a> &#187; newArray.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * Directive that handles the model arrays
 */
angular.module('schemaForm').directive('sfNewArray', ['sfSelect', 'sfPath', 'schemaForm',
<span class="fstat-no" title="function not covered" >function(sel, sfPath, schemaForm) {</span>
<span class="cstat-no" title="statement not covered" >  return {</span>
    scope: false,
    link: <span class="fstat-no" title="function not covered" >function(scope, element, attrs) {</span>
<span class="cstat-no" title="statement not covered" >      scope.min = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      scope.modelArray = scope.$eval(attrs.sfNewArray);</span>
&nbsp;
      // We need to have a ngModel to hook into validation. It doesn't really play well with
      // arrays though so we both need to trigger validation and onChange.
      // So we watch the value as well. But watching an array can be tricky. We wan't to know
      // when it changes so we can validate,
<span class="cstat-no" title="statement not covered" >      var watchFn =  <span class="fstat-no" title="function not covered" >function() {</span></span>
        //scope.modelArray = modelArray;
<span class="cstat-no" title="statement not covered" >        scope.modelArray = scope.$eval(attrs.sfNewArray);</span>
        // validateField method is exported by schema-validate
<span class="cstat-no" title="statement not covered" >        if (scope.validateField) {</span>
<span class="cstat-no" title="statement not covered" >          scope.validateField();</span>
        }
      };
&nbsp;
<span class="cstat-no" title="statement not covered" >      var onChangeFn =  <span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >        if (scope.form &amp;&amp; scope.form.onChange) {</span>
<span class="cstat-no" title="statement not covered" >          if (angular.isFunction(scope.form.onChange)) {</span>
<span class="cstat-no" title="statement not covered" >            scope.form.onChange(scope.modelArray, scope.form);</span>
          } else {
<span class="cstat-no" title="statement not covered" >            scope.evalExpr(scope.form.onChange, {'modelValue': scope.modelArray, form: scope.form});</span>
          }
        }
      };
&nbsp;
      // We need the form definition to make a decision on how we should listen.
<span class="cstat-no" title="statement not covered" >      var once = scope.$watch('form', <span class="fstat-no" title="function not covered" >function(form) {</span></span>
<span class="cstat-no" title="statement not covered" >        if (!form) {</span>
<span class="cstat-no" title="statement not covered" >          return;</span>
        }
&nbsp;
        // Always start with one empty form unless configured otherwise.
        // Special case: don't do it if form has a titleMap
<span class="cstat-no" title="statement not covered" >        if (!form.titleMap &amp;&amp; form.startEmpty !== true &amp;&amp; (!scope.modelArray || scope.modelArray.length === 0)) {</span>
<span class="cstat-no" title="statement not covered" >          scope.appendToArray();</span>
        }
&nbsp;
        // If we have "uniqueItems" set to true, we must deep watch for changes.
<span class="cstat-no" title="statement not covered" >        if (scope.form &amp;&amp; scope.form.schema &amp;&amp; scope.form.schema.uniqueItems === true) {</span>
<span class="cstat-no" title="statement not covered" >          scope.$watch(attrs.sfNewArray, watchFn, true);</span>
&nbsp;
          // We still need to trigger onChange though.
<span class="cstat-no" title="statement not covered" >          scope.$watch([attrs.sfNewArray, attrs.sfNewArray + '.length'], onChangeFn);</span>
&nbsp;
        } else {
          // Otherwise we like to check if the instance of the array has changed, or if something
          // has been added/removed.
<span class="cstat-no" title="statement not covered" >          if (scope.$watchGroup) {</span>
<span class="cstat-no" title="statement not covered" >            scope.$watchGroup([attrs.sfNewArray, attrs.sfNewArray + '.length'], <span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >              watchFn();</span>
<span class="cstat-no" title="statement not covered" >              onChangeFn();</span>
            });
          } else {
            // Angular 1.2 support
<span class="cstat-no" title="statement not covered" >            scope.$watch(attrs.sfNewArray, <span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >              watchFn();</span>
<span class="cstat-no" title="statement not covered" >              onChangeFn();</span>
            });
<span class="cstat-no" title="statement not covered" >            scope.$watch(attrs.sfNewArray + '.length', <span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >              watchFn();</span>
<span class="cstat-no" title="statement not covered" >              onChangeFn();</span>
            });
          }
        }
&nbsp;
        // Title Map handling
        // If form has a titleMap configured we'd like to enable looping over
        // titleMap instead of modelArray, this is used for intance in
        // checkboxes. So instead of variable number of things we like to create
        // a array value from a subset of values in the titleMap.
        // The problem here is that ng-model on a checkbox doesn't really map to
        // a list of values. This is here to fix that.
<span class="cstat-no" title="statement not covered" >        if (form.titleMap &amp;&amp; form.titleMap.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >          scope.titleMapValues = [];</span>
&nbsp;
          // We watch the model for changes and the titleMapValues to reflect
          // the modelArray
<span class="cstat-no" title="statement not covered" >          var updateTitleMapValues = <span class="fstat-no" title="function not covered" >function(arr) {</span></span>
<span class="cstat-no" title="statement not covered" >            scope.titleMapValues = [];</span>
<span class="cstat-no" title="statement not covered" >            arr = arr || [];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            form.titleMap.forEach(<span class="fstat-no" title="function not covered" >function(item) {</span></span>
<span class="cstat-no" title="statement not covered" >              scope.titleMapValues.push(arr.indexOf(item.value) !== -1);</span>
            });
          };
          //Catch default values
<span class="cstat-no" title="statement not covered" >          updateTitleMapValues(scope.modelArray);</span>
&nbsp;
          // TODO: Refactor and see if we can get rid of this watch by piggy backing on the
          // validation watch.
<span class="cstat-no" title="statement not covered" >          scope.$watchCollection('modelArray', updateTitleMapValues);</span>
&nbsp;
          //To get two way binding we also watch our titleMapValues
<span class="cstat-no" title="statement not covered" >          scope.$watchCollection('titleMapValues', <span class="fstat-no" title="function not covered" >function(vals, old) {</span></span>
<span class="cstat-no" title="statement not covered" >            if (vals &amp;&amp; vals !== old) {</span>
<span class="cstat-no" title="statement not covered" >              var arr = scope.modelArray;</span>
&nbsp;
              // Apparently the fastest way to clear an array, readable too.
              // http://jsperf.com/array-destroy/32
<span class="cstat-no" title="statement not covered" >              while (arr.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >                arr.pop();</span>
              }
<span class="cstat-no" title="statement not covered" >              form.titleMap.forEach(<span class="fstat-no" title="function not covered" >function(item, index) {</span></span>
<span class="cstat-no" title="statement not covered" >                if (vals[index]) {</span>
<span class="cstat-no" title="statement not covered" >                  arr.push(item.value);</span>
                }
              });
&nbsp;
              // Time to validate the rebuilt array.
              // validateField method is exported by schema-validate
<span class="cstat-no" title="statement not covered" >              if (scope.validateField) {</span>
<span class="cstat-no" title="statement not covered" >                scope.validateField();</span>
              }
            }
          });
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        once();</span>
      });
&nbsp;
<span class="cstat-no" title="statement not covered" >      scope.appendToArray = <span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >        var empty;</span>
&nbsp;
        // Create and set an array if needed.
<span class="cstat-no" title="statement not covered" >        var model = scope.modelArray;</span>
<span class="cstat-no" title="statement not covered" >        if (!model) {</span>
<span class="cstat-no" title="statement not covered" >          var selection = sfPath.parse(attrs.sfNewArray);</span>
<span class="cstat-no" title="statement not covered" >          model = [];</span>
<span class="cstat-no" title="statement not covered" >          sel(selection, scope, model);</span>
<span class="cstat-no" title="statement not covered" >          scope.modelArray = model;</span>
        }
&nbsp;
        // Same old add empty things to the array hack :(
<span class="cstat-no" title="statement not covered" >        if (scope.form &amp;&amp; scope.form.schema &amp;&amp; scope.form.schema.items) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          var items = scope.form.schema.items;</span>
<span class="cstat-no" title="statement not covered" >          if (items.type &amp;&amp; items.type.indexOf('object') !== -1) {</span>
<span class="cstat-no" title="statement not covered" >            empty = {};</span>
&nbsp;
            // Check for possible defaults
<span class="cstat-no" title="statement not covered" >            if (!scope.options || scope.options.setSchemaDefaults !== false) {</span>
<span class="cstat-no" title="statement not covered" >              empty = angular.isDefined(items['default']) ? items['default'] : empty;</span>
&nbsp;
              // Check for defaults further down in the schema.
              // If the default instance sets the new array item to something falsy, i.e. null
              // then there is no need to go further down.
<span class="cstat-no" title="statement not covered" >              if (empty) {</span>
<span class="cstat-no" title="statement not covered" >                schemaForm.traverseSchema(items, <span class="fstat-no" title="function not covered" >function(prop, path) {</span></span>
<span class="cstat-no" title="statement not covered" >                  if (angular.isDefined(prop['default'])) {</span>
<span class="cstat-no" title="statement not covered" >                    sel(path, empty, prop['default']);</span>
                  }
                });
              }
            }
&nbsp;
          } else <span class="cstat-no" title="statement not covered" >if (items.type &amp;&amp; items.type.indexOf('array') !== -1) {</span>
<span class="cstat-no" title="statement not covered" >            empty = [];</span>
<span class="cstat-no" title="statement not covered" >            if (!scope.options || scope.options.setSchemaDefaults !== false) {</span>
<span class="cstat-no" title="statement not covered" >              empty = items['default'] || empty;</span>
            }
          } else {
            // No type? could still have defaults.
<span class="cstat-no" title="statement not covered" >            if (!scope.options || scope.options.setSchemaDefaults !== false) {</span>
<span class="cstat-no" title="statement not covered" >              empty = items['default'] || empty;</span>
            }
          }
        }
<span class="cstat-no" title="statement not covered" >        model.push(empty);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return model;</span>
      };
&nbsp;
<span class="cstat-no" title="statement not covered" >      scope.deleteFromArray = <span class="fstat-no" title="function not covered" >function(index) {</span></span>
<span class="cstat-no" title="statement not covered" >        var model = scope.modelArray;</span>
<span class="cstat-no" title="statement not covered" >        if (model) {</span>
<span class="cstat-no" title="statement not covered" >          model.splice(index, 1);</span>
        }
<span class="cstat-no" title="statement not covered" >        return model;</span>
      };
&nbsp;
      // For backwards compatability, i.e. when a bootstrap-decorator tag is used
      // as child to the array.
<span class="cstat-no" title="statement not covered" >      var setIndex = <span class="fstat-no" title="function not covered" >function(index) {</span></span>
<span class="cstat-no" title="statement not covered" >        return <span class="fstat-no" title="function not covered" >function(form) {</span></span>
<span class="cstat-no" title="statement not covered" >          if (form.key) {</span>
<span class="cstat-no" title="statement not covered" >            form.key[form.key.indexOf('')] = index;</span>
          }
        };
      };
<span class="cstat-no" title="statement not covered" >      var formDefCache = {};</span>
<span class="cstat-no" title="statement not covered" >      scope.copyWithIndex = <span class="fstat-no" title="function not covered" >function(index) {</span></span>
<span class="cstat-no" title="statement not covered" >        var form = scope.form;</span>
<span class="cstat-no" title="statement not covered" >        if (!formDefCache[index]) {</span>
&nbsp;
          // To be more compatible with JSON Form we support an array of items
          // in the form definition of "array" (the schema just a value).
          // for the subforms code to work this means we wrap everything in a
          // section. Unless there is just one.
<span class="cstat-no" title="statement not covered" >          var subForm = form.items[0];</span>
<span class="cstat-no" title="statement not covered" >          if (form.items.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >            subForm = {</span>
              type: 'section',
              items: form.items.map(<span class="fstat-no" title="function not covered" >function(item) {</span>
<span class="cstat-no" title="statement not covered" >                item.ngModelOptions = form.ngModelOptions;</span>
<span class="cstat-no" title="statement not covered" >                if (angular.isUndefined(item.readonly)) {</span>
<span class="cstat-no" title="statement not covered" >                  item.readonly = form.readonly;</span>
                }
<span class="cstat-no" title="statement not covered" >                return item;</span>
              })
            };
          }
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (subForm) {</span>
<span class="cstat-no" title="statement not covered" >            var copy = angular.copy(subForm);</span>
<span class="cstat-no" title="statement not covered" >            copy.arrayIndex = index;</span>
<span class="cstat-no" title="statement not covered" >            schemaForm.traverseForm(copy, setIndex(index));</span>
<span class="cstat-no" title="statement not covered" >            formDefCache[index] = copy;</span>
          }
        }
<span class="cstat-no" title="statement not covered" >        return formDefCache[index];</span>
      };
&nbsp;
    }
  };
}]);
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Aug 30 2015 20:41:57 GMT+0200 (CEST)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
